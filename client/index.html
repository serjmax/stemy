<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="main.css" />
    <title>STEMY - –ß–∞—Å—Ç–∏ —Ä–µ—á–∏</title>
  </head>
  <body>
    <header>
      <img src="imgs/logo_100x100.png" alt="logo" class="img" />
      <h1>STEMY</h1>
      <span class="desc">
        –ß–∞—Å—Ç–∏ —Ä–µ—á–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ
        <a href="https://tech.yandex.ru/mystem/">Yandex.MyStem</a>
      </span>
      <button type="button" id="send" class="send">
        –ø–æ–¥—Å–≤–µ—Ç–∏—Ç—å
      </button>
    </header>
    <br />
    <div contenteditable id="editor" class="editor">
      –í–∞—à —à–µ–¥–µ–≤—Ä –≥–æ—Ç–æ–≤!<br />
      –†–∞–≤–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –Ω–æ–≤–∞—è –º–æ–¥–µ–ª—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π
      —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥–µ–ª–∏ —Ä–∞–∑–≤–∏—Ç–∏—è.–ó–∞–¥–∞—á–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –≤ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∂–µ —Å–ª–æ–∂–∏–≤—à–∞—è—Å—è
      —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏ —É—Ç–æ—á–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∏
      –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π. –ò–¥–µ–π–Ω—ã–µ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã—Å—à–µ–≥–æ –ø–æ—Ä—è–¥–∫–∞, –∞ —Ç–∞–∫–∂–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ
      –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ-–ø—Ä–æ–ø–∞–≥–∞–Ω–¥–∏—Å—Ç—Å–∫–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –Ω–∞—à–µ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ç—Ä–µ–±—É—é—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏ —É—Ç–æ—á–Ω–µ–Ω–∏—è
      —Å–∏—Å—Ç–µ–º –º–∞—Å—Å–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–∏—è. –ò–¥–µ–π–Ω—ã–µ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã—Å—à–µ–≥–æ –ø–æ—Ä—è–¥–∫–∞,–∞ —Ç–∞–∫–∂–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–º–µ—á–µ–Ω–Ω—ã—Ö
      –ø–ª–∞–Ω–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —à–∏—Ä–æ–∫–æ–º—É –∫—Ä—É–≥—É (—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤) —É—á–∞—Å—Ç–∏–µ –≤ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã
      –æ–±—É—á–µ–Ω–∏—è –∫–∞–¥—Ä–æ–≤, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞—Å—É—â–Ω—ã–º –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è–º. –ó–∞–¥–∞—á–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –≤ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∂–µ
      –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å —à–∏—Ä–æ–∫–∏–º –∞–∫—Ç–∏–≤–æ–º –≤ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏ –æ–±—É—Å–ª–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ—Ä–º —Ä–∞–∑–≤–∏—Ç–∏—è.
    </div>
    <div class="legend">
      <div class="legend-text A">A</div>
      <div class="legend-text ADV">ADV</div>
      <div class="legend-text ADVPRO">ADVPRO</div>
      <div class="legend-text ANUM">ANUM</div>
      <div class="legend-text APRO">APRO</div>
      <div class="legend-text COM">COM</div>
      <div class="legend-text CONJ">CONJ</div>
      <div class="legend-text INTJ">INTJ</div>
      <div class="legend-text NUM">NUM</div>
      <div class="legend-text PART">PART</div>
      <div class="legend-text PR">PR</div>
      <div class="legend-text S">S</div>
      <div class="legend-text SPRO">SPRO</div>
      <div class="legend-text V">V</div>
    </div>
  </body>
  <script>
    // const URL = 'http://localhost:3000/';
    const URL = window.location.origin;

    const LIMIT_CHARS = 55000;

    const BTN = document.getElementById('send');
    const EDITOR = document.getElementById('editor');

    function strip(html) {
      var tmp = document.createElement('DIV');
      tmp.innerHTML = html;
      return tmp.textContent || tmp.innerText;
    }

    EDITOR.oninput = event => {
      if (EDITOR.innerHTML.length > LIMIT_CHARS) {
        alert(
          '–°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π —Ç–µ–∫—Å—Ç! \n –ù–∞—à —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞–æ—Ç–∞—Ç—å –Ω–µ –±–æ–ª–µ–µ 55000 —Å–∏–º–≤–æ–ª–æ–≤ –∑–∞ —Ä–∞–∑.'
        );
        BTN.setAttribute('disabled', 'disabled');
        EDITOR.classList.add('editor-limit');
      } else {
        BTN.removeAttribute('disabled');
        EDITOR.classList.remove('editor-limit');
      }
    };

    // TODO
    // http://qaru.site/questions/256870/insert-value-into-textarea-where-cursor-was
    EDITOR.onpaste = event => {
      event.preventDefault();
      EDITOR.innerHTML += strip(event.clipboardData.getData('text/plain'));
    };

    BTN.onclick = () => {
      BTN.innerText = 'üé® —Ä–∞—Å–∫—Ä–∞—à–∏–≤–∞–µ–º ...';
      BTN.classList.add('send-loading');

      const attr = {
        method: 'POST',
        body: EDITOR.innerText,
        mode: 'cors',
        headers: {
          'Access-Control-Allow-Origin': '*',
        },
      };

      fetch(URL, attr)
        .then(res => {
          if (res.ok) return res.text();
          else throw new Error('Bad HTTP');
        })
        .then(data => {
          EDITOR.innerHTML = data;
        })
        .finally(() => {
          BTN.innerText = '–ø–æ–¥—Å–≤–µ—Ç–∏—Ç—å';
          BTN.classList.remove('send-loading');
        })
        .catch(err => {
          console.error('ERROR: ', err.message);
        });
    };
  </script>
</html>
